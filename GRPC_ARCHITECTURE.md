# gRPC-based Remote Solve Architecture

## Overview

cuOpt remote solve uses gRPC for transport and protobuf-generated stubs for the service API.
The request/response payloads are serialized with a protobuf-based serializer that maps
cuOpt data structures to protobuf messages. This preserves existing semantics while
moving the network layer to a standard, well-supported RPC stack.

## Service Definition

The gRPC service is defined in `cpp/src/linear_programming/utilities/cuopt_remote_service.proto`
and imports the message schema in `cuopt_remote.proto`. Code is generated by `protoc`
plus `grpc_cpp_plugin` during the build.

Core RPCs include:

- `SubmitJob` / `UploadAndSubmit`
- `CheckStatus`
- `GetResult` / `StreamResult`
- `StreamLogs`
- `CancelJob`
- `DeleteResult`
- `GetIncumbents`

## Components

### gRPC Server (`cuopt_grpc_server`)

- Source: `cpp/cuopt_grpc_server.cpp`
- Implements `CuOptRemoteService` and owns the worker process pool.
- Workers communicate with the main server process via shared memory + pipes.
- For results, the server calls `to_host()` before serialization.
- Supports streaming logs and incumbents through gRPC streaming endpoints.

### gRPC Client Path (C++)

- Client logic lives in `cpp/src/linear_programming/utilities/remote_solve_grpc.cpp`
  and is used by `remote_solve.cu` and `cuopt_cli`.
- The client serializes problems using the protobuf serializer, submits them
  via gRPC, and deserializes results back into cuOpt solution objects.

### Serialization Layer

- Default serializer: `cpp/src/linear_programming/utilities/protobuf_serializer.cu`
- Interface: `cpp/include/cuopt/linear_programming/utilities/remote_serialization.hpp`
- Optional plugin override: `CUOPT_SERIALIZER_LIB` can load a custom serializer.
- The serializer uses protobuf message types defined in `cuopt_remote.proto`.

## Data Flow (LP/MIP)

1. Client builds a problem (LP/MIP).
2. Serializer converts the problem + settings into protobuf bytes.
3. gRPC `SubmitJob` or `UploadAndSubmit` sends the bytes to the server.
4. Server deserializes to cuOpt data structures.
5. Server runs `solve_lp` / `solve_mip` in a worker process.
6. Server calls `to_host()` and serializes the solution to protobuf bytes.
7. Client retrieves results via `GetResult` / `StreamResult` and deserializes.

## Generated Code (protoc output)

Generated files are written to the CMake binary directory (not checked into source):

- `cuopt_remote.pb.cc/.h`
- `cuopt_remote_service.pb.cc/.h`
- `cuopt_remote_service.grpc.pb.cc/.h`

## Build Integration

`cpp/CMakeLists.txt` drives code generation:

- Locates `protoc` and `grpc_cpp_plugin`
- Runs `protoc` to generate the `*.pb.cc/.h` sources
- Adds generated sources to the `cuopt` library
- Builds `cuopt_grpc_server` only when gRPC is available

## Security Notes

- Service stubs and message parsing are generated by `protoc` and `grpc_cpp_plugin`.
- Payload serialization uses protobuf message APIs rather than hand-written parsing.
- gRPC provides HTTP/2 framing, flow control, and standard status codes.
```
